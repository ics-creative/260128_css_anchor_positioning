<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>タブUI</title>

    <link rel="stylesheet" href="style.css" />

    <style>
      /* animation-timeline 固有スタイル */
      .swipeTabs {
        overflow-x: auto;
        overflow-y: hidden;
        scroll-snap-type: x mandatory;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }

      .swipeTabs .tabbar {
        position: sticky;
        top: 0;
        left: 0;
        touch-action: pan-y;
      }

      .swipeTabs .tabbar .row .cushion {
        position: absolute;
        border-radius: 999px;
        background: #3223b3;
        pointer-events: none;

        position-anchor: --t1;
        top: anchor(top);
        left: anchor(left);
        width: anchor-size(width);
        height: anchor-size(height);

        animation: follow 1ms linear forwards;
        animation-timeline: scroll(nearest inline);
        animation-range: 0% 100%;
      }

      @keyframes follow {
        0% {
          top: anchor(--t1 top);
          left: anchor(--t1 left);
          width: anchor-size(--t1 width);
          height: anchor-size(--t1 height);
        }
        33.333% {
          top: anchor(--t2 top);
          left: anchor(--t2 left);
          width: anchor-size(--t2 width);
          height: anchor-size(--t2 height);
        }
        66.666% {
          top: anchor(--t3 top);
          left: anchor(--t3 left);
          width: anchor-size(--t3 width);
          height: anchor-size(--t3 height);
        }
        100% {
          top: anchor(--t4 top);
          left: anchor(--t4 left);
          width: anchor-size(--t4 width);
          height: anchor-size(--t4 height);
        }
      }

      /* タブ文字色もスクロールに同期 */
      .swipeTabs .tabbar .tab {
        animation-timeline: scroll(nearest inline);
        animation-range: 0% 100%;
        animation-duration: 1ms;
        animation-timing-function: linear;
        animation-fill-mode: forwards;
      }
      .swipeTabs .tabbar .tab:nth-child(1) { animation-name: tab1-color; }
      .swipeTabs .tabbar .tab:nth-child(2) { animation-name: tab2-color; }
      .swipeTabs .tabbar .tab:nth-child(3) { animation-name: tab3-color; }
      .swipeTabs .tabbar .tab:nth-child(4) { animation-name: tab4-color; }

      @keyframes tab1-color {
        0%, 16% { color: #fff; }
        17%, 100% { color: #555; }
      }
      @keyframes tab2-color {
        0%, 16% { color: #555; }
        17%, 49% { color: #fff; }
        50%, 100% { color: #555; }
      }
      @keyframes tab3-color {
        0%, 49% { color: #555; }
        50%, 82% { color: #fff; }
        83%, 100% { color: #555; }
      }
      @keyframes tab4-color {
        0%, 82% { color: #555; }
        83%, 100% { color: #fff; }
      }
    </style>
  </head>

  <body>
    <div id="app" v-cloak>
      <div class="demo">
        <div class="swipeTabs" ref="swipeTabs">
          <div class="tabbar">
            <div class="row" role="tablist">
              <a
                v-for="(tab, index) in tabs"
                :key="tab.id"
                class="tab"
                :href="`#${tab.panelId}`"
                :style="{ anchorName: `--t${index + 1}` }"
                role="tab"
                :id="tab.id"
                :aria-controls="tab.panelId"
                :aria-selected="activeTabIndex === index"
                >{{ tab.label }}</a
              >
              <div class="cushion"></div>
            </div>
          </div>

          <div class="slides">
            <section
              v-for="(panel, index) in panels"
              :key="panel.id"
              :ref="(el) => { if (el) panelRefs[index] = el }"
              class="panel"
              :id="panel.id"
              role="tabpanel"
              :aria-describedby="`tab-${index + 1}`"
              :aria-hidden="activeTabIndex !== index"
            >
              <h2>{{ panel.title }}</h2>
              <p>{{ panel.description }}</p>
              <div class="photo-grid">
                <div
                  v-for="(photo, photoIndex) in panel.photos"
                  :key="photoIndex"
                  class="photo-item"
                >
                  <img :src="photo.src" alt="" loading="lazy" />
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>

    <script type="importmap">
      {
        "imports": {
          "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.prod.js"
        }
      }
    </script>
    <script type="module">
      import { ref } from "vue";
      import { createTabApp } from "./main.js";

      createTabApp(() => ({
        swipeTabs: ref(null),
        panelRefs: [],
      })).mount("#app");
    </script>
  </body>
</html>
